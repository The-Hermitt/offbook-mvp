<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OffBook — MVP</title>
<style>
  :root { --bg:#0b0c10; --card:#151822; --ink:#e8ecf1; --muted:#aab1c4; --line:#22283a; --hi:#6b8cff; }
  * { box-sizing:border-box }
  body { margin:0; background:var(--bg); color:var(--ink); font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif }
  .tabs { position:sticky; top:0; display:flex; gap:6px; padding:8px; background:var(--bg); border-bottom:1px solid #232735; z-index:10 }
  .tabbtn { flex:1; padding:10px 8px; border-radius:10px; border:1px solid #232735; background:#111523; color:#cfd6e6; cursor:pointer }
  .tabbtn.active { background:linear-gradient(180deg,#1a1f33,#101426); color:#fff; border-color:#2d3552; outline:1px solid #2d3e7a }
  .page { display:none; padding:16px }
  .page.active { display:block }
  .card { background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; margin:12px 0 }
  .label { font-weight:600; color:#cfd6e6; margin-bottom:6px }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center }
  .input, textarea, select { width:100%; background:#0f1320; color:var(--ink); border:1px solid #283052; border-radius:10px; padding:10px }
  .btn { padding:10px 14px; border-radius:10px; border:1px solid #2a3450; background:#141a2b; color:var(--ink); cursor:pointer }
  .btn.primary { background:#1a2450; border-color:#2b3a7a }
  .btn.ok { background:#12361f; border-color:#1f6f3c; color:#bcf5cf }
  .btn.warn { background:#34260f; border-color:#6f4b1f; color:#ffe1b3 }
  .hidden { display:none !important }
  .hr { height:1px; background:#242a3a; margin:12px 0 }
  .vrow { display:grid; grid-template-columns: 1fr 180px; gap:10px; margin:8px 0 }
  .pill { display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid #2a3450; background:#12182a; font-size:12px; color:#cfd6e6 }
  .banner { border:1px dashed #5c6280; background:#0f1322; padding:12px; border-radius:12px; margin-top:10px }
</style>

<!-- pdf.js & worker (browser) -->
<script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js";</script>
<!-- tesseract.js (browser) -->
<script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
</head>
<body>

<div class="tabs">
  <button class="tabbtn active" data-tab="import">Import</button>
  <button class="tabbtn" data-tab="assign">Assign</button>
  <button class="tabbtn" data-tab="rehearse">Rehearse</button>
  <button class="tabbtn" data-tab="record">Record</button>
  <button class="tabbtn" data-tab="gallery">Gallery</button>
  <button class="tabbtn" data-tab="settings">Settings</button>
</div>

<!-- IMPORT -->
<div id="import" class="page active">
  <!-- SECRET (hidden: we read from ?secret=) -->
  <input id="secret" class="input hidden" placeholder="Secret"/>

  <div class="card">
    <div class="label">Paste Script Text</div>
    <textarea id="pasteText" rows="6" placeholder="JANE: Hello.
GABE: Hey there.
JANE: Ready?"></textarea>
    <div class="row" style="margin-top:8px">
      <input id="pasteTitle" class="input" placeholder="Title (optional)" value="Pasted Sides"/>
      <button id="btnPaste" class="btn ok">Import → Assign</button>
    </div>
  </div>

  <div class="card">
    <div class="label">Upload PDF</div>
    <div class="row">
      <input id="pdfFile" type="file" accept="application/pdf" class="input"/>
      <input id="pdfTitle" class="input" placeholder="Title" value="Uploaded PDF"/>
    </div>
    <div class="row" style="margin-top:8px">
      <button id="btnUpload" class="btn primary">Server Parse → Assign</button>
      <button id="btnClientOCR" class="btn warn hidden">Try Client OCR (Beta)</button>
    </div>
    <div id="scanBanner" class="banner hidden">
      <div style="font-weight:600; margin-bottom:6px">Scanned PDF detected (server couldn’t read it)</div>
      <div class="muted">Click <b>Try Client OCR (Beta)</b> to OCR 2–3 pages in your browser and continue.</div>
    </div>
  </div>
</div>

<!-- ASSIGN -->
<div id="assign" class="page">
  <div class="card">
    <div class="label">Assign Voices</div>
    <div id="assignScript" style="color:#aab1c4; margin-bottom:8px">—</div>

    <div class="row" style="max-width:520px">
      <div style="flex:1">
        <div class="label">I am…</div>
        <select id="iamSelect" class="input"></select>
      </div>
      <div style="flex:1"></div>
    </div>

    <div class="hr"></div>
    <div id="voiceRows"></div>

    <div class="row" style="margin-top:10px">
      <button id="btnAssignContinue" class="btn ok">Continue → Rehearse</button>
    </div>
  </div>
</div>

<!-- placeholder tabs -->
<div id="rehearse" class
